# Document Storage Reset Feature - Technical Plan

## Brief Description

Add a reset button to the Documents tab that allows users to clear all document storage from the UI. The button should be positioned to the right of the existing Refresh button in the header section, with a confirmation dialog to prevent accidental deletion. This feature integrates with the existing `/storage/reset` endpoint and follows the established separation of concerns architecture.

## Files and Functions to be Modified/Created

### Frontend Changes

**Files to modify:**
- `covenantrix-desktop/src/features/documents/DocumentsScreen.tsx` - Add reset button and confirmation dialog
- `covenantrix-desktop/src/services/api/DocumentsApi.ts` - Add reset storage API method
- `covenantrix-desktop/src/types/document.ts` - Add reset storage response types
- `covenantrix-desktop/src/components/icons/index.ts` - Add Trash2 icon for reset button

**New files to create:**
- `covenantrix-desktop/src/components/ui/ConfirmationModal.tsx` - Reusable confirmation dialog component

### Backend Changes

**Files to modify:**
- `backend/api/routes/storage.py` - Already exists with `/storage/reset` endpoint
- `backend/domain/documents/service.py` - Already exists with `reset_storage()` method

## Implementation Details

### Frontend Implementation

**1. DocumentsScreen Component Updates:**
- Add reset button next to Refresh button in header section (lines 94-112)
- Import Trash2 icon from lucide-react
- Add confirmation modal state management
- Implement reset handler that calls DocumentsApi.resetStorage()
- Add loading state during reset operation
- Refresh document list after successful reset

**2. DocumentsApi Service Updates:**
- Add `resetStorage()` method that calls `POST /storage/reset` with `confirm=true`
- Handle reset response and error states
- Return structured response with success/error information

**3. Type Definitions:**
- Add `ResetStorageResponse` interface to document types
- Include success, message, details, and error fields

**4. ConfirmationModal Component:**
- Create reusable modal component for confirmation dialogs
- Accept title, message, confirmText, cancelText, and onConfirm props
- Use existing modal styling patterns from UpgradeModal
- Include destructive action styling for reset confirmation

### UI/UX Design

**Reset Button Placement:**
- Position to the right of Refresh button in DocumentsScreen header
- Use Trash2 icon from Lucide React
- Apply secondary button styling (not dominant)
- Include tooltip: "Reset all documents"

**Confirmation Dialog:**
- Title: "Reset Document Storage"
- Message: "This will permanently delete all documents and their processing data. This action cannot be undone. Are you sure you want to continue?"
- Confirm button: "Reset All Documents" (destructive styling)
- Cancel button: "Cancel" (secondary styling)

**Loading States:**
- Show loading spinner on reset button during operation
- Disable reset button while operation is in progress
- Display success/error toast notifications

### API Integration

**Reset Storage Endpoint:**
- Use existing `POST /storage/reset` endpoint
- Send `confirm=true` parameter
- Handle response with detailed reset information
- Display success message with number of files cleared

**Error Handling:**
- Handle network errors gracefully
- Show user-friendly error messages
- Allow retry on failure
- Log errors for debugging

### Architecture Compliance

**Separation of Concerns:**
- UI Layer: DocumentsScreen handles user interaction and state
- Service Layer: DocumentsApi handles API communication
- Component Layer: ConfirmationModal handles confirmation logic
- Type Layer: Document types define data contracts

**State Management:**
- Local component state for modal visibility
- Loading states for async operations
- Error states for user feedback
- Document list refresh after successful reset

**Error Boundaries:**
- Graceful error handling in reset operation
- User-friendly error messages
- Fallback to document list refresh on error
- Console logging for debugging

### User Experience Flow

1. User clicks reset button in Documents tab header
2. Confirmation modal appears with warning message
3. User confirms action by clicking "Reset All Documents"
4. Loading state shows on reset button
5. API call to `/storage/reset` with confirmation
6. Success toast shows number of files cleared
7. Document list refreshes to show empty state
8. User can upload new documents

### Technical Considerations

**Performance:**
- Reset operation may take time for large document sets
- Show loading indicators during operation
- Handle timeout scenarios gracefully

**Data Integrity:**
- Reset clears all document processing data
- Preserves user settings and chat history
- Maintains application configuration

**Accessibility:**
- Proper ARIA labels for reset button
- Keyboard navigation support
- Screen reader friendly confirmation dialog
- Focus management in modal

**Internationalization:**
- Use existing translation keys where possible
- Add new keys for reset-specific messages
- Maintain consistency with existing UI text
