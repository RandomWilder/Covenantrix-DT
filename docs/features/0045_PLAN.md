# Copy Message Content Feature - Technical Plan

## Overview
Add copy-to-clipboard functionality for chat messages, allowing users to copy text from either user messages or assistant responses. Users should be able to copy the response content so they can paste it into their own documents or use as they wish. The feature should be simple, follow industry best practices, and maintain separation of concerns as established in the codebase.

## Current State Analysis

### Existing Implementation
- **Message Component**: `covenantrix-desktop/src/features/chat/Message.tsx` - Displays individual messages with role-based styling
- **Message Types**: Defined in `covenantrix-desktop/src/types/chat.ts`
  - User messages: Plain text with `whitespace-pre-wrap`
  - Assistant messages: Rendered as Markdown using `react-markdown` with `remark-gfm`
- **Icon System**: Centralized in `covenantrix-desktop/src/components/icons/index.ts` using Lucide React
- **UI Framework**: React + TypeScript + Tailwind CSS

### Key Files Identified
- `covenantrix-desktop/src/features/chat/Message.tsx` (lines 1-93) - Message display component
- `covenantrix-desktop/src/types/chat.ts` (lines 18-26) - Message interface definition
- `covenantrix-desktop/src/components/icons/index.ts` - Icon exports

## Technical Implementation

### 1. Create Clipboard Utility Hook
**File**: `covenantrix-desktop/src/hooks/useClipboard.ts`

**Purpose**: Reusable React hook for copy-to-clipboard functionality with feedback

**Features**:
- Use browser's native Clipboard API (`navigator.clipboard.writeText()`)
- Provide visual feedback on successful copy
- Handle copy errors gracefully
- Reset copied state after timeout (e.g., 2 seconds)

**Hook Interface**:
```typescript
interface UseClipboardReturn {
  copied: boolean
  copyToClipboard: (text: string) => Promise<void>
  error: string | null
}
```

**Implementation Details**:
- State management for `copied` boolean flag
- State management for `error` string
- Async function to write to clipboard
- Auto-reset timer using `useEffect` cleanup
- Error handling for clipboard API failures (permissions, unsupported browsers)

### 2. Add Copy Icons to Icon Index
**File**: `covenantrix-desktop/src/components/icons/index.ts`

**Changes**:
- Add `Copy` icon from `lucide-react` for default copy state
- Add `Check` icon from `lucide-react` for copied state confirmation
- Export both icons in the common icons section

### 3. Enhance Message Component
**File**: `covenantrix-desktop/src/features/chat/Message.tsx`

**Changes**:
- Import `useClipboard` hook
- Import `Copy` and `Check` icons
- Add copy button to message content area
- Position button in top-right corner of message bubble (absolute positioning)
- Show button on hover (desktop) or always visible (mobile/touch devices)
- Toggle icon between `Copy` and `Check` based on copied state
- Add tooltip/aria-label for accessibility
- Copy plain text content from `message.content` regardless of role

**UI Behavior**:
- Button appears on hover over message bubble
- Small, unobtrusive button in top-right corner of message
- Smooth transition on hover
- Icon changes to checkmark on successful copy
- Returns to copy icon after 2 seconds
- Appropriate opacity and colors for light/dark themes
- Does not interfere with text selection

**Styling Approach**:
- Use Tailwind CSS for all styling
- Absolute positioning within relative parent container
- Transparent background with hover state
- Match existing dark mode color scheme
- Small size (e.g., `w-4 h-4` icon in `p-2` button)

## Implementation Algorithm

### Copy to Clipboard Flow
1. **User Interaction**: User hovers over message and clicks copy button
2. **Extract Content**: Get `message.content` from message object (plain text)
3. **Copy to Clipboard**: Call `navigator.clipboard.writeText(content)`
4. **Visual Feedback**: Change icon from Copy to Check
5. **Auto-Reset**: After 2 seconds, reset icon back to Copy
6. **Error Handling**: If clipboard fails, show error state or fallback to textarea selection

### Hover State Management
```typescript
// Use CSS hover state for simplicity
// Button visibility controlled by parent:hover in Tailwind
// Group utility: parent div has group class, button uses group-hover
```

### Copy Button Positioning
```typescript
// Message bubble container: position-relative
// Copy button: position-absolute top-2 right-2
// Z-index to ensure button appears above content
```

## Files to Create/Modify

### New Files
1. `covenantrix-desktop/src/hooks/useClipboard.ts` - Clipboard hook with copy functionality and feedback

### Modified Files
1. `covenantrix-desktop/src/components/icons/index.ts` - Add Copy and Check icons
2. `covenantrix-desktop/src/features/chat/Message.tsx` - Integrate copy button into message UI

## User Experience

### Visual Design
- **Copy Button**: Small icon button in top-right corner of each message
- **Hover State**: Button fades in on message hover (opacity transition)
- **Copied State**: Icon changes to checkmark with green tint for 2 seconds
- **Theme Support**: Proper colors for both light and dark themes
- **Accessibility**: Proper ARIA labels and keyboard support

### Interaction Pattern
1. User hovers over any message (user or assistant)
2. Copy button fades in at top-right corner
3. User clicks copy button
4. Icon changes to checkmark
5. Content is copied to clipboard
6. After 2 seconds, icon returns to copy icon
7. User can paste content anywhere

### Error Handling
- If clipboard API is unavailable, log warning (graceful degradation)
- If copy fails, show brief error state
- Fallback: Could use legacy `document.execCommand('copy')` if needed

## Dependencies

### New Dependencies
- **Zero new dependencies** - Uses browser's native Clipboard API (`navigator.clipboard`)
- Uses existing Lucide React icons

### Browser Compatibility
- Clipboard API is supported in all modern browsers
- Requires HTTPS or localhost context
- Fallback not strictly necessary for Electron app (always has clipboard access)

## Separation of Concerns

### Hook Layer (`useClipboard`)
- Handles clipboard API interaction
- Manages copy state and feedback timing
- Provides reusable interface for any component

### Component Layer (`Message`)
- UI presentation and user interaction
- Consumes clipboard hook
- Manages button visibility and styling

### Icon Layer (`icons/index.ts`)
- Centralized icon exports
- Maintains consistency across application

